<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JT's Tracking Manager</title>

    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <h1>JT's Outdoor Fabrics</h1>

    <div id="redirect" style="display: inline;">
        <p>Redirecting...</p>
    </div>

    <div id="invalid" style="display: none;">
        <p>The provided tracking number is not valid. Please contact us at info@jtsoutdoorfabrics.com or 1 (877)
            780-2722.</p>
    </div>

    <script>
        const delay = ms => new Promise(res => setTimeout(res, ms));

        const redirect = async barCode => {
            // if the barcode starts with the Canpar "D", perform Canpar stuff...
            if (barCode.toUpperCase().startsWith("D")) {
                if (barCode.includes(",")) {
                    const array = barCode.split(",");
                    const address = array.join("%2C+");
                    await delay(2000);
                    window.location.replace(`https://canpar.ca/en/tracking/track.htm?barcode=${address}`);
                } else {
                    await delay(2000);
                    window.location.replace(`https://canpar.ca/en/tracking/track.htm?barcode=${barCode}`);
                }
            } else if (barCode.startsWith("1018")) {
                console.log(`Barcode: ${barCode}`);
            } else {
                const redirect = document.getElementById("redirect");
                const invalid = document.getElementById("invalid");
                redirect.style.display = "none";
                invalid.style.display = "inline";
            }
        };

        const querySearch = window.location.search;
        const urlParams = new URLSearchParams(querySearch);
        const barCode = urlParams.get("barcode");
        redirect(barCode);
    </script>
</body>

</html>
